<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reloj</title>
  <style>
    body {
      background-color: #000;
      color: lime;
      font-family: monospace;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    #reloj {
      font-size: 150px;
      transition: color 0.5s ease;
      letter-spacing: 5px;
    }
  </style>
</head>
<body>

<div id="reloj">--:--</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCt3XT8ZcFB58UVZMgeCbAoV0X9XF5o6Xk",
    authDomain: "reloj-magico.firebaseapp.com",
    databaseURL: "https://reloj-magico-default-rtdb.firebaseio.com",
    projectId: "reloj-magico",
    storageBucket: "reloj-magico.appspot.com",
    messagingSenderId: "391313162883",
    appId: "1:391313162883:web:a6373ca815ce02369211b6"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const reloj = document.getElementById("reloj");

  let targetTime = null;
  let interval = null;
  let detenido = false;

  // Escucha cambios desde Firebase
  db.ref("reloj").on("value", (snapshot) => {
    const data = snapshot.val();
    if (data && data.start) {
      targetTime = data.targetTime;
      detenido = false;
      reloj.style.color = "lime";
      iniciarReloj();
    } else {
      detenido = false;
      targetTime = null;
    }
  });

  function iniciarReloj() {
    if (interval) clearInterval(interval);

    interval = setInterval(() => {
      if (detenido) return;

      const ahora = new Date();
      const hora = String(ahora.getHours()).padStart(2, '0');
      const minuto = String(ahora.getMinutes()).padStart(2, '0');
      const horaActual = `${hora}:${minuto}`;
      reloj.textContent = horaActual;

      if (targetTime) {
        const [h, m] = targetTime.split(":").map(Number);
        if (ahora.getHours() === h && ahora.getMinutes() === m) {
          detenerReloj(horaActual);
        }
      }
    }, 1000);
  }

  function detenerReloj(horaAlcanzada) {
    detenido = true;
    reloj.textContent = horaAlcanzada;
    reloj.style.color = "red";
    clearInterval(interval);
  }

  iniciarReloj();
</script>

</body>
</html>
