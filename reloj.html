<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reloj en Vivo</title>
  <style>
    body {
      background-color: #000;
      color: lime;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
    #reloj {
      font-size: 100px;
      transition: color 0.5s ease;
    }
    #estado {
      margin-top: 20px;
      font-size: 24px;
    }
    button {
      margin-top: 20px;
      font-size: 20px;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background-color: lime;
      color: black;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="reloj">--:--:--</div>
<div id="estado">Esperando hora...</div>
<button onclick="reiniciar()">Reiniciar reloj</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCt3XT8ZcFB58UVZMgeCbAoV0X9XF5o6Xk",
    authDomain: "reloj-magico.firebaseapp.com",
    databaseURL: "https://reloj-magico-default-rtdb.firebaseio.com",
    projectId: "reloj-magico",
    storageBucket: "reloj-magico.appspot.com",
    messagingSenderId: "391313162883",
    appId: "1:391313162883:web:a6373ca815ce02369211b6"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const reloj = document.getElementById("reloj");
  const estado = document.getElementById("estado");

  let targetTime = null;
  let interval = null;
  let detenido = false;

  db.ref("reloj").on("value", (snapshot) => {
    const data = snapshot.val();
    if (data && data.start) {
      targetTime = data.targetTime;
      detenido = false;
      estado.textContent = "Contando hacia " + targetTime;
      reloj.style.color = "lime";
      iniciarReloj();
    }
  });

  function iniciarReloj() {
    if (interval) clearInterval(interval);

    interval = setInterval(() => {
      if (detenido) return;

      const ahora = new Date();
      const horaActual = ahora.toTimeString().slice(0, 8);
      reloj.textContent = horaActual;

      if (targetTime) {
        const [h, m] = targetTime.split(":").map(Number);
        if (ahora.getHours() === h && ahora.getMinutes() === m && ahora.getSeconds() === 0) {
          detenerReloj();
        }
      }
    }, 1000);
  }

  function detenerReloj() {
    detenido = true;
    reloj.style.color = "red";
    estado.textContent = "‚è∞ Hora alcanzada: " + targetTime;
    clearInterval(interval);
  }

  function reiniciar() {
    db.ref("reloj").set({ start: false });
    detenido = false;
    reloj.style.color = "lime";
    estado.textContent = "Esperando hora...";
    reloj.textContent = "--:--:--";
  }

  iniciarReloj();
</script>

</body>
</html>

